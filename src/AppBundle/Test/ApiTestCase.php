<?php

namespace AppBundle\Test;

use Doctrine\Common\DataFixtures\Purger\ORMPurger;
use GuzzleHttp\Client;
use Symfony\Bundle\FrameworkBundle\Test\KernelTestCase;

class ApiTestCase extends KernelTestCase
{
	private static $staticClient;

	/**
	 * @var Client
	 */
	protected $client;

	public static function setUpBeforeClass()
	{
		self::$staticClient = new Client([
			'base_url' => 'http://localhost:8000',
			'defaults' => [
				'exceptions' => false
			]
		]);

		self::bootKernel();
	}

	protected function setUp()
	{
		$this->client = self::$staticClient;
		$this->purgeDatabase();
	}

	/**
	 * Clean up Kernel usage in this test.
	 */
	protected function tearDown()
	{
		// purposefully not calling parent class, which shuts down the kernel
	}

	protected function getService($id)
	{
		return self::$kernel->getContainer()
			->get($id);
	}

	private function purgeDatabase()
	{
		$purger = new ORMPurger($this->getService('doctrine')->getManager());
		$purger->purge();
	}
}
